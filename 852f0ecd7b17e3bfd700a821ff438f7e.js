ace.define("ace/ext/beautify",["require","exports","module","ace/token_iterator"],(function(require,exports,module){"use strict";var TokenIterator=require("../token_iterator").TokenIterator;function is(token,type){return token.type.lastIndexOf(type+".xml")>-1}exports.singletonTags=["area","base","br","col","command","embed","hr","html","img","input","keygen","link","meta","param","source","track","wbr"],exports.blockTags=["article","aside","blockquote","body","div","dl","fieldset","footer","form","head","header","html","nav","ol","p","script","section","style","table","tbody","tfoot","thead","ul"],exports.formatOptions={lineBreaksAfterCommasInCurlyBlock:!0},exports.beautify=function(session){for(var nextToken,row,i,iterator=new TokenIterator(session,0,0),token=iterator.getCurrentToken(),tabString=session.getTabString(),singletonTags=exports.singletonTags,blockTags=exports.blockTags,formatOptions=exports.formatOptions||{},breakBefore=!1,spaceBefore=!1,spaceAfter=!1,code="",value="",tagName="",depth=0,lastDepth=0,lastIndent=0,indent=0,unindent=0,roundDepth=0,curlyDepth=0,curRow=0,rowsToAdd=0,indentNextLine=!1,inTag=!1,inCSS=!1,inBlock=!1,levels={0:0},parents=[],caseBody=!1,trimNext=function(){nextToken&&nextToken.value&&"string.regexp"!==nextToken.type&&(nextToken.value=nextToken.value.replace(/^\s*/,""))},trimLine=function(){for(var end=code.length-1;0!=end&&" "===code[end];)end-=1;code=code.slice(0,end+1)},trimCode=function(){code=code.trimRight(),breakBefore=!1};null!==token;){if(curRow=iterator.getCurrentTokenRow(),iterator.$rowTokens,nextToken=iterator.stepForward(),void 0!==token){if(value=token.value,unindent=0,inCSS="style"===tagName||"ace/mode/css"===session.$modeId,is(token,"tag-open")?(inTag=!0,nextToken&&(inBlock=-1!==blockTags.indexOf(nextToken.value)),"</"===value&&(inBlock&&!breakBefore&&rowsToAdd<1&&rowsToAdd++,inCSS&&(rowsToAdd=1),unindent=1,inBlock=!1)):is(token,"tag-close")?inTag=!1:is(token,"comment.start")?inBlock=!0:is(token,"comment.end")&&(inBlock=!1),inTag||rowsToAdd||"paren.rparen"!==token.type||"}"!==token.value.substr(0,1)||rowsToAdd++,curRow!==row&&(rowsToAdd=curRow,row&&(rowsToAdd-=row)),rowsToAdd){for(trimCode();rowsToAdd>0;rowsToAdd--)code+="\n";breakBefore=!0,is(token,"comment")||token.type.match(/^(comment|string)$/)||(value=value.trimLeft())}if(value){if("keyword"===token.type&&value.match(/^(if|else|elseif|for|foreach|while|switch)$/)?(parents[depth]=value,trimNext(),spaceAfter=!0,value.match(/^(else|elseif)$/)&&code.match(/\}[\s]*$/)&&(trimCode(),spaceBefore=!0)):"paren.lparen"===token.type?(trimNext(),"{"===value.substr(-1)&&(spaceAfter=!0,indentNextLine=!1,inTag||(rowsToAdd=1)),"{"===value.substr(0,1)&&(spaceBefore=!0,"["!==code.substr(-1)&&"["===code.trimRight().substr(-1)?(trimCode(),spaceBefore=!1):")"===code.trimRight().substr(-1)?trimCode():trimLine())):"paren.rparen"===token.type?(unindent=1,"}"===value.substr(0,1)&&("case"===parents[depth-1]&&unindent++,"{"===code.trimRight().substr(-1)?trimCode():(spaceBefore=!0,inCSS&&(rowsToAdd+=2))),"]"===value.substr(0,1)&&"}"!==code.substr(-1)&&"}"===code.trimRight().substr(-1)&&(spaceBefore=!1,indent++,trimCode()),")"===value.substr(0,1)&&"("!==code.substr(-1)&&"("===code.trimRight().substr(-1)&&(spaceBefore=!1,indent++,trimCode()),trimLine()):"keyword.operator"!==token.type&&"keyword"!==token.type||!value.match(/^(=|==|===|!=|!==|&&|\|\||and|or|xor|\+=|.=|>|>=|<|<=|=>)$/)?"punctuation.operator"===token.type&&";"===value?(trimCode(),trimNext(),spaceAfter=!0,inCSS&&rowsToAdd++):"punctuation.operator"===token.type&&value.match(/^(:|,)$/)?(trimCode(),trimNext(),value.match(/^(,)$/)&&curlyDepth>0&&0===roundDepth&&formatOptions.lineBreaksAfterCommasInCurlyBlock?rowsToAdd++:(spaceAfter=!0,breakBefore=!1)):"support.php_tag"!==token.type||"?>"!==value||breakBefore?is(token,"attribute-name")&&code.substr(-1).match(/^\s$/)?spaceBefore=!0:is(token,"attribute-equals")?(trimLine(),trimNext()):is(token,"tag-close")?(trimLine(),"/>"===value&&(spaceBefore=!0)):"keyword"===token.type&&value.match(/^(case|default)$/)&&caseBody&&(unindent=1):(trimCode(),spaceBefore=!0):(trimCode(),trimNext(),spaceBefore=!0,spaceAfter=!0),breakBefore&&(!token.type.match(/^(comment)$/)||value.substr(0,1).match(/^[/#]$/))&&(!token.type.match(/^(string)$/)||value.substr(0,1).match(/^['"@]$/))){if(indent=lastIndent,depth>lastDepth)for(indent++,i=depth;i>lastDepth;i--)levels[i]=indent;else depth<lastDepth&&(indent=levels[depth]);for(lastDepth=depth,lastIndent=indent,unindent&&(indent-=unindent),indentNextLine&&!roundDepth&&(indent++,indentNextLine=!1),i=0;i<indent;i++)code+=tabString}if("keyword"===token.type&&value.match(/^(case|default)$/)?!1===caseBody&&(parents[depth]=value,depth++,caseBody=!0):"keyword"===token.type&&value.match(/^(break)$/)&&parents[depth-1]&&parents[depth-1].match(/^(case|default)$/)&&(depth--,caseBody=!1),"paren.lparen"===token.type&&(roundDepth+=(value.match(/\(/g)||[]).length,curlyDepth+=(value.match(/\{/g)||[]).length,depth+=value.length),"keyword"===token.type&&value.match(/^(if|else|elseif|for|while)$/)?(indentNextLine=!0,roundDepth=0):!roundDepth&&value.trim()&&"comment"!==token.type&&(indentNextLine=!1),"paren.rparen"===token.type)for(roundDepth-=(value.match(/\)/g)||[]).length,curlyDepth-=(value.match(/\}/g)||[]).length,i=0;i<value.length;i++)depth--,"}"===value.substr(i,1)&&"case"===parents[depth]&&depth--;"text"==token.type&&(value=value.replace(/\s+$/," ")),spaceBefore&&!breakBefore&&(trimLine(),"\n"!==code.substr(-1)&&(code+=" ")),code+=value,spaceAfter&&(code+=" "),breakBefore=!1,spaceBefore=!1,spaceAfter=!1,(is(token,"tag-close")&&(inBlock||-1!==blockTags.indexOf(tagName))||is(token,"doctype")&&">"===value)&&(rowsToAdd=inBlock&&nextToken&&"</"===nextToken.value?-1:1),nextToken&&-1===singletonTags.indexOf(nextToken.value)&&(is(token,"tag-open")&&"</"===value?depth--:is(token,"tag-open")&&"<"===value?depth++:is(token,"tag-close")&&"/>"===value&&depth--),is(token,"tag-name")&&(tagName=value),row=curRow}}token=nextToken}code=code.trim(),session.doc.setValue(code)},exports.commands=[{name:"beautify",description:"Format selection (Beautify)",exec:function(editor){exports.beautify(editor.session)},bindKey:"Ctrl-Shift-B"}]})),ace.require(["ace/ext/beautify"],(function(m){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=m)}));