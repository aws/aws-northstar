ace.define("ace/ext/command_bar",["require","exports","module","ace/tooltip","ace/lib/event_emitter","ace/lib/lang","ace/lib/dom","ace/lib/oop","ace/lib/useragent"],(function(require,exports,module){var __values=this&&this.__values||function(o){var s="function"==typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")},Tooltip=require("../tooltip").Tooltip,EventEmitter=require("../lib/event_emitter").EventEmitter,lang=require("../lib/lang"),dom=require("../lib/dom"),oop=require("../lib/oop"),useragent=require("../lib/useragent"),BUTTON_CLASS_NAME="command_bar_tooltip_button",minPosition=function(posA,posB){return posB.row>posA.row||posB.row===posA.row&&posB.column>posA.column?posA:posB},keyDisplayMap={Ctrl:{mac:"^"},Option:{mac:"⌥"},Command:{mac:"⌘"},Cmd:{mac:"⌘"},Shift:"⇧",Left:"←",Right:"→",Up:"↑",Down:"↓"},CommandBarTooltip=function(){function CommandBarTooltip(parentNode,options){var e_1,_a;options=options||{},this.parentNode=parentNode,this.tooltip=new Tooltip(this.parentNode),this.moreOptions=new Tooltip(this.parentNode),this.maxElementsOnTooltip=options.maxElementsOnTooltip||4,this.$alwaysShow=options.alwaysShow||!1,this.eventListeners={},this.elements={},this.commands={},this.tooltipEl=dom.buildDom(["div",{class:"command_bar_tooltip"}],this.tooltip.getElement()),this.moreOptionsEl=dom.buildDom(["div",{class:"command_bar_tooltip tooltip_more_options"}],this.moreOptions.getElement()),this.$showTooltipTimer=lang.delayedCall(this.$showTooltip.bind(this),options.showDelay||100),this.$hideTooltipTimer=lang.delayedCall(this.$hideTooltip.bind(this),options.hideDelay||100),this.$tooltipEnter=this.$tooltipEnter.bind(this),this.$onMouseMove=this.$onMouseMove.bind(this),this.$onChangeScroll=this.$onChangeScroll.bind(this),this.$onEditorChangeSession=this.$onEditorChangeSession.bind(this),this.$scheduleTooltipForHide=this.$scheduleTooltipForHide.bind(this),this.$preventMouseEvent=this.$preventMouseEvent.bind(this);try{for(var _b=__values(["mousedown","mouseup","click"]),_c=_b.next();!_c.done;_c=_b.next()){var event=_c.value;this.tooltip.getElement().addEventListener(event,this.$preventMouseEvent),this.moreOptions.getElement().addEventListener(event,this.$preventMouseEvent)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_1)throw e_1.error}}}return CommandBarTooltip.prototype.registerCommand=function(id,command){var registerForMainTooltip=Object.keys(this.commands).length<this.maxElementsOnTooltip;registerForMainTooltip||this.elements.MoreOptionsButton||this.$createCommand("MoreOptionsButton",{name:"···",exec:function(){this.$shouldHideMoreOptions=!1,this.$setMoreOptionsVisibility(!this.isMoreOptionsShown())}.bind(this),type:"checkbox",getValue:function(){return this.isMoreOptionsShown()}.bind(this),enabled:!0},!0),this.$createCommand(id,command,registerForMainTooltip),this.isShown()&&this.updatePosition()},CommandBarTooltip.prototype.isShown=function(){return!!this.tooltip&&this.tooltip.isOpen},CommandBarTooltip.prototype.isMoreOptionsShown=function(){return!!this.moreOptions&&this.moreOptions.isOpen},CommandBarTooltip.prototype.getAlwaysShow=function(){return this.$alwaysShow},CommandBarTooltip.prototype.setAlwaysShow=function(alwaysShow){this.$alwaysShow=alwaysShow,this.$updateOnHoverHandlers(!this.$alwaysShow),this._signal("alwaysShow",this.$alwaysShow)},CommandBarTooltip.prototype.attach=function(editor){!editor||this.isShown()&&this.editor===editor||(this.detach(),this.editor=editor,this.editor.on("changeSession",this.$onEditorChangeSession),this.editor.session&&(this.editor.session.on("changeScrollLeft",this.$onChangeScroll),this.editor.session.on("changeScrollTop",this.$onChangeScroll)),this.getAlwaysShow()?this.$showTooltip():this.$updateOnHoverHandlers(!0))},CommandBarTooltip.prototype.updatePosition=function(){if(this.editor){var ranges,renderer=this.editor.renderer;if((ranges=this.editor.selection.getAllRanges?this.editor.selection.getAllRanges():[this.editor.getSelectionRange()]).length){for(var range,minPos=minPosition(ranges[0].start,ranges[0].end),i=0;range=ranges[i];i++)minPos=minPosition(minPos,minPosition(range.start,range.end));var pos=renderer.$cursorLayer.getPixelPosition(minPos,!0),tooltipEl=this.tooltip.getElement(),screenWidth=window.innerWidth,screenHeight=window.innerHeight,rect=this.editor.container.getBoundingClientRect();pos.top+=rect.top-renderer.layerConfig.offset,pos.left+=rect.left+renderer.gutterWidth-renderer.scrollLeft;var cursorVisible=pos.top>=rect.top&&pos.top<=rect.bottom&&pos.left>=rect.left+renderer.gutterWidth&&pos.left<=rect.right;if(cursorVisible||!this.isShown())if(cursorVisible&&!this.isShown()&&this.getAlwaysShow())this.$showTooltip();else{var top=pos.top-tooltipEl.offsetHeight,left=Math.min(screenWidth-tooltipEl.offsetWidth,pos.left);if(top>=0&&top+tooltipEl.offsetHeight<=screenHeight&&left>=0&&left+tooltipEl.offsetWidth<=screenWidth){if(this.tooltip.setPosition(left,top),this.isMoreOptionsShown()){top+=tooltipEl.offsetHeight,left=this.elements.MoreOptionsButton.getBoundingClientRect().left;var moreOptionsEl=this.moreOptions.getElement();screenHeight=window.innerHeight;top+moreOptionsEl.offsetHeight>screenHeight&&(top-=tooltipEl.offsetHeight+moreOptionsEl.offsetHeight),left+moreOptionsEl.offsetWidth>screenWidth&&(left=screenWidth-moreOptionsEl.offsetWidth),this.moreOptions.setPosition(left,top)}}else this.$hideTooltip()}else this.$hideTooltip()}}},CommandBarTooltip.prototype.update=function(){Object.keys(this.elements).forEach(this.$updateElement.bind(this))},CommandBarTooltip.prototype.detach=function(){this.tooltip.hide(),this.moreOptions.hide(),this.$updateOnHoverHandlers(!1),this.editor&&(this.editor.off("changeSession",this.$onEditorChangeSession),this.editor.session&&(this.editor.session.off("changeScrollLeft",this.$onChangeScroll),this.editor.session.off("changeScrollTop",this.$onChangeScroll))),this.$mouseInTooltip=!1,this.editor=null},CommandBarTooltip.prototype.destroy=function(){this.tooltip&&this.moreOptions&&(this.detach(),this.tooltip.destroy(),this.moreOptions.destroy()),this.eventListeners={},this.commands={},this.elements={},this.tooltip=this.moreOptions=this.parentNode=null},CommandBarTooltip.prototype.$createCommand=function(id,command,forMainTooltip){var buttonNode,parentEl=forMainTooltip?this.tooltipEl:this.moreOptionsEl,keyParts=[],bindKey=command.bindKey;bindKey&&("object"==typeof bindKey&&(bindKey=useragent.isMac?bindKey.mac:bindKey.win),keyParts=(keyParts=(bindKey=bindKey.split("|")[0]).split("-")).map((function(key){if(keyDisplayMap[key]){if("string"==typeof keyDisplayMap[key])return keyDisplayMap[key];if(useragent.isMac&&keyDisplayMap[key].mac)return keyDisplayMap[key].mac}return key}))),forMainTooltip&&command.iconCssClass?buttonNode=["div",{class:["ace_icon_svg",command.iconCssClass].join(" "),"aria-label":command.name+" ("+command.bindKey+")"}]:(buttonNode=[["div",{class:"command_bar_button_value"}],["div",{class:"command_bar_button_caption"},command.name]],keyParts.length&&buttonNode.push(["div",{class:"command_bar_keybinding"},keyParts.map((function(keyPart){return["div",keyPart]}))])),dom.buildDom(["div",{class:[BUTTON_CLASS_NAME,command.cssClass||""].join(" "),ref:id},buttonNode],parentEl,this.elements),this.commands[id]=command;var eventListener=function(e){this.editor&&this.editor.focus(),this.$shouldHideMoreOptions=this.isMoreOptionsShown(),!this.elements[id].disabled&&command.exec&&command.exec(this.editor),this.$shouldHideMoreOptions&&this.$setMoreOptionsVisibility(!1),this.update(),e.preventDefault()}.bind(this);this.eventListeners[id]=eventListener,this.elements[id].addEventListener("click",eventListener.bind(this)),this.$updateElement(id)},CommandBarTooltip.prototype.$setMoreOptionsVisibility=function(visible){visible?(this.moreOptions.setTheme(this.editor.renderer.theme),this.moreOptions.setClassName("command_bar_tooltip_wrapper"),this.moreOptions.show(),this.update(),this.updatePosition()):this.moreOptions.hide()},CommandBarTooltip.prototype.$onEditorChangeSession=function(e){e.oldSession&&(e.oldSession.off("changeScrollTop",this.$onChangeScroll),e.oldSession.off("changeScrollLeft",this.$onChangeScroll)),this.detach()},CommandBarTooltip.prototype.$onChangeScroll=function(){this.editor.renderer&&(this.isShown()||this.getAlwaysShow())&&this.editor.renderer.once("afterRender",this.updatePosition.bind(this))},CommandBarTooltip.prototype.$onMouseMove=function(e){if(!this.$mouseInTooltip){var cursorPosition=this.editor.getCursorPosition(),cursorScreenPosition=this.editor.renderer.textToScreenCoordinates(cursorPosition.row,cursorPosition.column),lineHeight=this.editor.renderer.lineHeight;e.clientY>=cursorScreenPosition.pageY&&e.clientY<cursorScreenPosition.pageY+lineHeight?(this.isShown()||this.$showTooltipTimer.isPending()||this.$showTooltipTimer.delay(),this.$hideTooltipTimer.isPending()&&this.$hideTooltipTimer.cancel()):(this.isShown()&&!this.$hideTooltipTimer.isPending()&&this.$hideTooltipTimer.delay(),this.$showTooltipTimer.isPending()&&this.$showTooltipTimer.cancel())}},CommandBarTooltip.prototype.$preventMouseEvent=function(e){this.editor&&this.editor.focus(),e.preventDefault()},CommandBarTooltip.prototype.$scheduleTooltipForHide=function(){this.$mouseInTooltip=!1,this.$showTooltipTimer.cancel(),this.$hideTooltipTimer.delay()},CommandBarTooltip.prototype.$tooltipEnter=function(){this.$mouseInTooltip=!0,this.$showTooltipTimer.isPending()&&this.$showTooltipTimer.cancel(),this.$hideTooltipTimer.isPending()&&this.$hideTooltipTimer.cancel()},CommandBarTooltip.prototype.$updateOnHoverHandlers=function(enableHover){var tooltipEl=this.tooltip.getElement(),moreOptionsEl=this.moreOptions.getElement();enableHover?(this.editor&&(this.editor.on("mousemove",this.$onMouseMove),this.editor.renderer.getMouseEventTarget().addEventListener("mouseout",this.$scheduleTooltipForHide,!0)),tooltipEl.addEventListener("mouseenter",this.$tooltipEnter),tooltipEl.addEventListener("mouseleave",this.$scheduleTooltipForHide),moreOptionsEl.addEventListener("mouseenter",this.$tooltipEnter),moreOptionsEl.addEventListener("mouseleave",this.$scheduleTooltipForHide)):(this.editor&&(this.editor.off("mousemove",this.$onMouseMove),this.editor.renderer.getMouseEventTarget().removeEventListener("mouseout",this.$scheduleTooltipForHide,!0)),tooltipEl.removeEventListener("mouseenter",this.$tooltipEnter),tooltipEl.removeEventListener("mouseleave",this.$scheduleTooltipForHide),moreOptionsEl.removeEventListener("mouseenter",this.$tooltipEnter),moreOptionsEl.removeEventListener("mouseleave",this.$scheduleTooltipForHide))},CommandBarTooltip.prototype.$showTooltip=function(){this.isShown()||(this.tooltip.setTheme(this.editor.renderer.theme),this.tooltip.setClassName("command_bar_tooltip_wrapper"),this.tooltip.show(),this.update(),this.updatePosition(),this._signal("show"))},CommandBarTooltip.prototype.$hideTooltip=function(){this.$mouseInTooltip=!1,this.isShown()&&(this.moreOptions.hide(),this.tooltip.hide(),this._signal("hide"))},CommandBarTooltip.prototype.$updateElement=function(id){var command=this.commands[id];if(command){var el=this.elements[id],commandEnabled=command.enabled;if("function"==typeof commandEnabled&&(commandEnabled=commandEnabled(this.editor)),"function"==typeof command.getValue){var value=command.getValue(this.editor);if("text"===command.type)el.textContent=value;else if("checkbox"===command.type){var domCssFn=value?dom.addCssClass:dom.removeCssClass,isOnTooltip=el.parentElement===this.tooltipEl;el.ariaChecked=value,isOnTooltip?domCssFn(el,"ace_selected"):domCssFn(el=el.querySelector(".command_bar_button_value"),"ace_checkmark")}}commandEnabled&&el.disabled?(dom.removeCssClass(el,"ace_disabled"),el.ariaDisabled=el.disabled=!1,el.removeAttribute("disabled")):commandEnabled||el.disabled||(dom.addCssClass(el,"ace_disabled"),el.ariaDisabled=el.disabled=!0,el.setAttribute("disabled",""))}},CommandBarTooltip}();oop.implement(CommandBarTooltip.prototype,EventEmitter),dom.importCssString("\n.ace_tooltip.".concat("command_bar_tooltip","_wrapper {\n    padding: 0;\n}\n\n.ace_tooltip .").concat("command_bar_tooltip"," {\n    padding: 1px 5px;\n    display: flex;\n    pointer-events: auto;\n}\n\n.ace_tooltip .").concat("command_bar_tooltip",".tooltip_more_options {\n    padding: 1px;\n    flex-direction: column;\n}\n\ndiv.").concat(BUTTON_CLASS_NAME," {\n    display: inline-flex;\n    cursor: pointer;\n    margin: 1px;\n    border-radius: 2px;\n    padding: 2px 5px;\n    align-items: center;\n}\n\ndiv.").concat(BUTTON_CLASS_NAME,".ace_selected,\ndiv.").concat(BUTTON_CLASS_NAME,":hover:not(.ace_disabled) {\n    background-color: rgba(0, 0, 0, 0.1);\n}\n\ndiv.").concat(BUTTON_CLASS_NAME,".ace_disabled {\n    color: #777;\n    pointer-events: none;\n}\n\ndiv.").concat(BUTTON_CLASS_NAME," .ace_icon_svg {\n    height: 12px;\n    background-color: #000;\n}\n\ndiv.").concat(BUTTON_CLASS_NAME,".ace_disabled .ace_icon_svg {\n    background-color: #777;\n}\n\n.").concat("command_bar_tooltip",".tooltip_more_options .").concat(BUTTON_CLASS_NAME," {\n    display: flex;\n}\n\n.").concat("command_bar_tooltip",".").concat("command_bar_button_value"," {\n    display: none;\n}\n\n.").concat("command_bar_tooltip",".tooltip_more_options .").concat("command_bar_button_value"," {\n    display: inline-block;\n    width: 12px;\n}\n\n.").concat("command_bar_button_caption"," {\n    display: inline-block;\n}\n\n.").concat("command_bar_keybinding"," {\n    margin: 0 2px;\n    display: inline-block;\n    font-size: 8px;\n}\n\n.").concat("command_bar_tooltip",".tooltip_more_options .").concat("command_bar_keybinding"," {\n    margin-left: auto;\n}\n\n.").concat("command_bar_keybinding"," div {\n    display: inline-block;\n    min-width: 8px;\n    padding: 2px;\n    margin: 0 1px;\n    border-radius: 2px;\n    background-color: #ccc;\n    text-align: center;\n}\n\n.ace_dark.ace_tooltip .").concat("command_bar_tooltip"," {\n    background-color: #373737;\n    color: #eee;\n}\n\n.ace_dark div.").concat(BUTTON_CLASS_NAME,".ace_disabled {\n    color: #979797;\n}\n\n.ace_dark div.").concat(BUTTON_CLASS_NAME,".ace_selected,\n.ace_dark div.").concat(BUTTON_CLASS_NAME,":hover:not(.ace_disabled) {\n    background-color: rgba(255, 255, 255, 0.1);\n}\n\n.ace_dark div.").concat(BUTTON_CLASS_NAME," .ace_icon_svg {\n    background-color: #eee;\n}\n\n.ace_dark div.").concat(BUTTON_CLASS_NAME,".ace_disabled .ace_icon_svg {\n    background-color: #979797;\n}\n\n.ace_dark .").concat(BUTTON_CLASS_NAME,".ace_disabled {\n    color: #979797;\n}\n\n.ace_dark .").concat("command_bar_keybinding"," div {\n    background-color: #575757;\n}\n\n.ace_checkmark::before {\n    content: '✓';\n}\n"),"commandbar.css",!1),exports.CommandBarTooltip=CommandBarTooltip,exports.TOOLTIP_CLASS_NAME="command_bar_tooltip",exports.BUTTON_CLASS_NAME=BUTTON_CLASS_NAME})),ace.require(["ace/ext/command_bar"],(function(m){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=m)}));